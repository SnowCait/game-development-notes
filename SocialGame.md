# ソーシャルゲーム開発

## ディレクトリ構成
* root
  * master
  * api
  * realtime
  * multi
  * batch
  * admin
  * infra
  * document
  * ci
    * Jenkinsfiles

## DB構成
* User (Sharding)
* Game\[, Share, Common\]
* Log (Partition)
* Kpi

### 注意
* 対象範囲が漏れるので `23:59:59` や `BETWEEN` を使わない
  * 必ず `2018-01-01 00:00:00 <= x < 2018-01-02 00:00:00` で比較する

## クライアント
* 本番アプリのコードにデバッグ用コードは含めない `#if DEBUG`
* アセットの容量はファイル毎に管理できるようにしておく

## サーバー
* 個数のあるものは上限（と下限）を設定する。
* ゲーム内通貨もアイテムとして扱った方が楽かも。
* ヘルスチェック用 API を用意しておく

## 共通
* Swagger 導入
  * API ドキュメント
  * バリデーション

## 要設計
* 例外・エラー
* バリデーション
* ログ
  * エラー箇所や原因を特定できるようになっているか
  * 対応しないといけないものだけエラーログに出力する（メンテはエラーログに出さない）
* デバッグコマンド
  * サーバーはデプロイしない or ユーザー判定して弾く
  * クライアントはバイナリいじったら有効にできてしまうのでそもそもコード自体含めない方が良い
* 現在時刻を変更するデバッグコマンド
  * 外部ストレージは影響を受けやすいので注意（ DynamoDB で TTL を設定すると自動削除されるなど）
* 共通コード（親クラスや trait などで作成）
  * ページャ
* メンテナンス運用
  * 定期 or 不定期
  * パーティションで消せない不要データ削除
  * メンテ時に行うアップデートの定義

## 課金設計
### 方針
全てアイテムとして扱う。複数種類のアイテムをセット販売できるようにする。  
効果を即適用したい場合はアイテムとして付与したのち使用させる。

### CSV
`Item.csv`, `Payment.csv`, `Payment_items.csv`

## コミュニケーション
最近はスタンプのみでのコミュニケーションが主流。
* NGワードの設定をしなくてよい
* 出会い系の考慮をしなくてよい
* スタンプを各言語対応することで海外ユーザーとコミュニケーションがとれる

## 機能
* ユーザー
  * 認証
* フォロー（申請あり/なし）
* ギルド
* クエスト
* ミッション
* ログインボーナス
* アイテム
  * ガチャ
  * ショップ
  * 交換所
  * プレゼント
  * 補填
* 装備
  * 保護
* 箱庭
* パーティ
* マルチルーム
* 強化進化
* メンテナンス（ユーザーの権限次第で回避）
* 通知
* 設定

### ゲーム固有でなさそうなもの
* ユーザー
* ガチャ
* アイテム
* 交換所
* プレゼント
* ログインボーナス
* フォロー
* 箱庭
* メンテナンス

### プラットフォーム依存
* 認証
* 課金（ショップ）

## 補填
* 指定期間にログインしたユーザーに配布
  * マスターデータや DB に配布情報を載せてユーザーがログインしたときに配る（これが無駄なデータ増えなくて良さそう）
  * 対象ユーザーを抽出してバッチでプレゼントに積む

## 課金
* ISO 基準の国名コードや通貨コードを使う
* キャッシュはなるべく避けた方がいいかも

## コード自動生成
* 生成されたファイルにコメントで生成元ファイル名を入れておく `Generated by ~`
